<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Text Processing Tool</title>
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/style.css') }}"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
        />
    </head>
    <body>
        <div class="container">
            <!-- 头部 -->
            <header class="header">
                <h3><i class="fas fa-text-width"></i> Text Processing Tool</h3>
                <!-- <p>专业的文本分析和处理平台</p> -->
            </header>

            <!-- 主要内容区域 -->
            <main class="main-content">
                <!-- 文本处理区域 - 输入和输出并列 -->
                <section class="text-processing-section">
                    <!-- 控制按钮区域 -->
                    <div class="controls-header">
                        <div class="button-group">
                            <button id="processBtn" class="btn btn-primary">
                                <i class="fas fa-cogs"></i> 处理文本
                            </button>
                            <button id="regexBtn" class="btn btn-info">
                                <i class="fas fa-magic"></i> 正则匹配与替换
                            </button>
                            <button id="translateBtn" class="btn btn-success">
                                <i class="fas fa-language"></i> 翻译
                            </button>
                            <button id="clearBtn" class="btn btn-secondary">
                                <i class="fas fa-trash"></i> 清空
                            </button>
                        </div>
                    </div>

                    <div class="text-windows-container">
                        <!-- 输入区域 -->
                        <div class="input-window">
                            <div class="section-header">
                                <h2><i class="fas fa-edit"></i> 输入文本</h2>
                                <div class="input-controls">
                                    <div class="text-counter">
                                        <span id="charCount">0</span> 字符
                                    </div>
                                    <div class="window-controls">
                                        <button id="addInputWindow" class="btn btn-sm btn-outline" title="添加输入窗口">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                        <button id="removeInputWindow" class="btn btn-sm btn-outline" title="移除输入窗口" disabled>
                                            <i class="fas fa-minus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="input-windows-container">
                                <div class="input-window-item active" data-window-id="1">
                                    <div class="textarea-container">
                                        <textarea
                                            id="inputText1"
                                            class="input-textarea"
                                            placeholder="请在此处粘贴或输入要处理的文本..."
                                            rows="12"
                                            style="resize: vertical; max-height: 800px; min-height: 200px;"
                                        ></textarea>
                                        <button
                                            class="copy-btn"
                                            data-target="inputText1"
                                            title="复制文本"
                                        >
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 可拖动的分隔线 -->
                        <!-- <div class="resize-handle" id="resizeHandle">
                            <div class="resize-indicator">
                                <i class="fas fa-grip-lines"></i>
                            </div>
                        </div> -->

                        <!-- 输出区域 -->
                        <div class="output-window">
                            <div class="section-header">
                                <h2>
                                    <i class="fas fa-chart-bar"></i> 处理结果
                                </h2>
                                <div class="output-controls">
                                    <div class="view-toggle">
                                        <button
                                            class="toggle-btn active"
                                            data-view="processed"
                                        >
                                            处理文本
                                        </button>
                                        <button
                                            class="toggle-btn"
                                            data-view="statistics"
                                        >
                                            统计信息
                                        </button>
                                        <button
                                            class="toggle-btn"
                                            data-view="analysis"
                                        >
                                            文本分析
                                        </button>
                                    </div>
                                    <div class="window-controls">
                                        <button id="addOutputWindow" class="btn btn-sm btn-outline" title="添加输出窗口">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                        <button id="removeOutputWindow" class="btn btn-sm btn-outline" title="移除输出窗口" disabled>
                                            <i class="fas fa-minus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="output-windows-container">
                                <div class="output-window-item active" data-window-id="1">
                                    <div class="output-container">
                                        <!-- 处理文本视图 -->
                                        <div
                                            id="processedView1"
                                            class="output-view active"
                                        >
                                            <div class="text-output">
                                                <pre id="processedText1">测试文本 - 请点击复制按钮测试复制功能</pre>
                                                <button
                                                    class="copy-btn"
                                                    data-target="processedText1"
                                                    title="复制结果"
                                                >
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- 统计信息视图 -->
                                        <div id="statisticsView1" class="output-view">
                                            <div class="statistics-grid">
                                                <div class="stat-card">
                                                    <h4>基本统计</h4>
                                                    <div id="basicStats1"></div>
                                                </div>
                                                <div class="stat-card">
                                                    <h4>字符类型</h4>
                                                    <div id="charStats1"></div>
                                                </div>
                                                <div class="stat-card">
                                                    <h4>词频统计</h4>
                                                    <div id="wordFreq1"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 文本分析视图 -->
                                        <div id="analysisView1" class="output-view">
                                            <div class="analysis-grid">
                                                <div class="analysis-card">
                                                    <h4>可读性分析</h4>
                                                    <div id="readability1"></div>
                                                </div>
                                                <div class="analysis-card">
                                                    <h4>情感分析</h4>
                                                    <div id="sentiment1"></div>
                                                </div>
                                                <div class="analysis-card">
                                                    <h4>语言特征</h4>
                                                    <div id="languageFeatures1"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 控制区域 -->
                <section class="controls-section">
                    <!-- 选项卡导航 -->
                    <div class="controls-tabs">
                        <button class="tab-btn active" data-tab="options">
                            <i class="fas fa-cog"></i> 处理选项
                        </button>
                        <button class="tab-btn" data-tab="translation">
                            <i class="fas fa-language"></i> 翻译设置
                        </button>
                        <button class="tab-btn" data-tab="regex">
                            <i class="fas fa-code"></i> 正则规则
                        </button>
                        <button class="tab-btn" data-tab="tasks">
                            <i class="fas fa-tasks"></i> 任务队列
                        </button>
                    </div>

                    <!-- 选项卡内容 -->
                    <div class="tab-content">
                        <!-- 处理选项选项卡 -->
                        <div id="optionsTab" class="tab-pane active">
                            <div class="options-section">
                                <h3><i class="fas fa-cog"></i> 处理选项</h3>
                                <div class="options-grid">
                                    <label class="option-item">
                                        <input
                                            type="checkbox"
                                            id="formatOption"
                                            checked
                                        />
                                        <span class="checkmark"></span>
                                        文本格式化
                                    </label>
                                    <label class="option-item">
                                        <input
                                            type="checkbox"
                                            id="statisticsOption"
                                            checked
                                        />
                                        <span class="checkmark"></span>
                                        统计信息
                                    </label>
                                    <label class="option-item">
                                        <input
                                            type="checkbox"
                                            id="analysisOption"
                                            checked
                                        />
                                        <span class="checkmark"></span>
                                        文本分析
                                    </label>
                                    <label class="option-item">
                                        <input
                                            type="checkbox"
                                            id="regexOption"
                                        />
                                        <span class="checkmark"></span>
                                        正则匹配与替换
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- 翻译设置选项卡 -->
                        <div id="translationTab" class="tab-pane">
                            <div class="translation-section">
                                <h3>
                                    <i class="fas fa-language"></i> 翻译设置
                                </h3>
                                <div class="translation-settings">
                                    <div class="translation-input-group">
                                        <label for="translationPrompt"
                                            >翻译提示词:</label
                                        >
                                        <div class="prompt-input-container">
                                            <textarea
                                                id="translationPrompt"
                                                placeholder="请输入翻译提示词，例如：请将以下文本翻译成中文："
                                                rows="3"
                                            ></textarea>
                                            <div class="prompt-controls">
                                                <button
                                                    type="button"
                                                    id="selectPromptBtn"
                                                    class="btn btn-sm btn-outline"
                                                    title="选择提示词"
                                                >
                                                    <i class="fas fa-list"></i> 选择提示词
                                                </button>
                                                <button
                                                    type="button"
                                                    id="savePromptBtn"
                                                    class="btn btn-sm btn-outline"
                                                    title="保存当前提示词"
                                                >
                                                    <i class="fas fa-save"></i> 保存
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 提示词管理区域 -->
                                    <div class="prompt-management-section">
                                        <h4><i class="fas fa-bookmark"></i> 提示词管理</h4>
                                        <div class="prompt-management-content">
                                            <div class="prompt-actions">
                                                <button
                                                    type="button"
                                                    id="addPromptBtn"
                                                    class="btn btn-sm btn-primary"
                                                >
                                                    <i class="fas fa-plus"></i> 添加提示词
                                                </button>
                                                <button
                                                    type="button"
                                                    id="exportPromptsBtn"
                                                    class="btn btn-sm btn-outline"
                                                >
                                                    <i class="fas fa-download"></i> 导出
                                                </button>
                                                <button
                                                    type="button"
                                                    id="importPromptsBtn"
                                                    class="btn btn-sm btn-outline"
                                                >
                                                    <i class="fas fa-upload"></i> 导入
                                                </button>
                                                <button
                                                    type="button"
                                                    id="clearPromptsBtn"
                                                    class="btn btn-sm btn-outline"
                                                >
                                                    <i class="fas fa-trash"></i> 清空
                                                </button>
                                            </div>
                                            
                                            <!-- 提示词列表 -->
                                            <div class="prompt-list-container">
                                                <div class="prompt-list-header">
                                                    <h5>我的提示词</h5>
                                                    <div class="prompt-filter">
                                                        <select id="promptCategoryFilter" class="prompt-filter-select">
                                                            <option value="">所有分类</option>
                                                            <option value="translation">翻译</option>
                                                            <option value="polish">润色</option>
                                                            <option value="summary">总结</option>
                                                            <option value="custom">自定义</option>
                                                            <option value="imported">导入</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="prompt-list" id="promptList">
                                                    <!-- 提示词列表将在这里动态生成 -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 隐藏的文件输入元素 -->
                                    <input
                                        type="file"
                                        id="promptFileInput"
                                        accept=".json,.txt"
                                        style="display: none"
                                    />
                                    <div class="translation-service-group">
                                        <label for="translationService"
                                            >翻译服务:</label
                                        >
                                        <select
                                            id="translationService"
                                            class="service-select"
                                        >
                                            <option value="">加载中...</option>
                                        </select>
                                    </div>
                                    
                                    <!-- API配置区域 -->
                                    <div class="api-config-section">
                                        <h4><i class="fas fa-key"></i> API 配置</h4>
                                        <div class="api-config-content">
                                            <div class="api-config-item">
                                                <label for="apiKeyInput">API Key:</label>
                                                <div class="api-key-input-group">
                                                    <input
                                                        type="password"
                                                        id="apiKeyInput"
                                                        placeholder="请输入您的API密钥"
                                                        class="api-key-input"
                                                    />
                                                    <button
                                                        type="button"
                                                        id="toggleApiKeyBtn"
                                                        class="toggle-password-btn"
                                                        title="显示/隐藏API密钥"
                                                    >
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="api-config-item">
                                                <label for="modelSelect">模型选择:</label>
                                                <select id="modelSelect" class="model-select">
                                                    <option value="">请先选择翻译服务</option>
                                                </select>
                                            </div>
                                            <div class="api-config-actions">
                                                <button
                                                    type="button"
                                                    id="saveApiConfigBtn"
                                                    class="btn btn-primary btn-sm"
                                                >
                                                    <i class="fas fa-save"></i> 保存配置
                                                </button>
                                                <button
                                                    type="button"
                                                    id="clearApiConfigBtn"
                                                    class="btn btn-secondary btn-sm"
                                                >
                                                    <i class="fas fa-trash"></i> 清除配置
                                                </button>
                                                <button
                                                    type="button"
                                                    id="testApiConfigBtn"
                                                    class="btn btn-info btn-sm"
                                                >
                                                    <i class="fas fa-check"></i> 测试连接
                                                </button>
                                            </div>
                                            <div id="apiConfigStatus" class="api-config-status"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 正则规则选项卡 -->
                        <div id="regexTab" class="tab-pane">
                            <!-- 正则规则编写区域 -->
                            <div class="regex-rules-section">
                                <div class="section-header">
                                    <h2>
                                        <i class="fas fa-code"></i> 正则规则编写
                                    </h2>
                                    <div class="text-counter">
                                        <span id="regexRulesCharCount">0</span>
                                        字符
                                    </div>
                                </div>
                                <div class="textarea-container">
                                    <textarea
                                        id="regexReplaceRules"
                                        placeholder='请在此处编写正则匹配-替换规则，格式如：&#10;(r"\\\\(|\\\\)", r"$"),&#10;(r"\\*\\*\\*\\*", r"*")'
                                        rows="8"
                                    ></textarea>
                                    <button
                                        class="copy-btn"
                                        data-target="regexReplaceRules"
                                        title="复制规则"
                                    >
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <div class="parse-rules-section">
                                    <button
                                        id="parseRulesBtn"
                                        class="btn btn-warning"
                                    >
                                        <i class="fas fa-magic"></i> 解析规则
                                    </button>
                                </div>
                            </div>

                            <div class="regex-section">
                                <div class="regex-section-header">
                                    <h3>
                                        <i class="fas fa-code"></i>
                                        正则匹配与替换规则
                                    </h3>
                                    <!-- 导入和导出按钮 -->
                                    <div class="regex-import-export">
                                        <button
                                            id="importRegexRules"
                                            class="btn btn-sm btn-outline"
                                        >
                                            <i class="fas fa-upload"></i>
                                            导入正则匹配替换规则
                                        </button>
                                        <button
                                            id="exportRegexRules"
                                            class="btn btn-sm btn-outline"
                                        >
                                            <i class="fas fa-download"></i>
                                            导出正则匹配替换规则
                                        </button>
                                    </div>
                                </div>

                                <!-- 隐藏的文件输入元素 -->
                                <input
                                    type="file"
                                    id="regexFileInput"
                                    accept=".txt,.rules,.json"
                                    style="display: none"
                                />

                                <div class="regex-rules-container">
                                    <div class="regex-rule-input">
                                        <input type="text" id="regexPattern"
                                        placeholder="正则表达式模式，例如:
                                        \"([^\"]+)\"" class="regex-input" />
                                        <span class="arrow">→</span>
                                        <input
                                            type="text"
                                            id="regexReplacement"
                                            placeholder="替换内容，例如: '$1'"
                                            class="regex-input"
                                        />
                                        <button
                                            id="addRegexRule"
                                            class="btn btn-sm btn-success"
                                        >
                                            <i class="fas fa-plus"></i> 添加规则
                                        </button>
                                    </div>
                                    <div
                                        style="
                                            color: #888;
                                            font-size: 0.95em;
                                            margin: 6px 0 10px 0;
                                        "
                                    >
                                        示例：将 hh "hello" 替换为 hh 'hello'
                                        &nbsp;|&nbsp; 匹配模式:
                                        <code>\"([^\"]+)\"</code> &nbsp;
                                        替换内容:
                                        <code>'$1'</code>
                                    </div>

                                    <!-- 可调整大小的规则列表窗口 -->
                                    <div class="regex-rules-window">
                                        <div class="regex-rules-header">
                                            <h4>规则列表</h4>
                                            <div class="regex-rules-controls">
                                                <button
                                                    class="btn btn-sm btn-outline"
                                                    id="expandRegexRules"
                                                >
                                                    <i
                                                        class="fas fa-expand"
                                                    ></i>
                                                </button>
                                                <button
                                                    class="btn btn-sm btn-outline"
                                                    id="collapseRegexRules"
                                                >
                                                    <i
                                                        class="fas fa-compress"
                                                    ></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div
                                            class="regex-rules-content"
                                            id="regexRulesList"
                                        >
                                            <!-- 规则列表将在这里动态生成 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 任务队列选项卡 -->
                        <div id="tasksTab" class="tab-pane">
                            <div class="tasks-section">
                                <div class="section-header">
                                    <h3><i class="fas fa-tasks"></i> 任务队列</h3>
                                    <div class="task-controls">
                                        <button id="clearCompletedTasks" class="btn btn-sm btn-outline">
                                            <i class="fas fa-trash"></i> 清空已完成
                                        </button>
                                        <button id="refreshTasks" class="btn btn-sm btn-outline">
                                            <i class="fas fa-sync"></i> 刷新
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="tasks-container">
                                    <div class="tasks-tabs">
                                        <button class="task-tab-btn active" data-task-status="all">
                                            <i class="fas fa-list"></i> 全部任务
                                        </button>
                                        <button class="task-tab-btn" data-task-status="pending">
                                            <i class="fas fa-clock"></i> 待处理
                                        </button>
                                        <button class="task-tab-btn" data-task-status="processing">
                                            <i class="fas fa-spinner"></i> 处理中
                                        </button>
                                        <button class="task-tab-btn" data-task-status="completed">
                                            <i class="fas fa-check"></i> 已完成
                                        </button>
                                        <button class="task-tab-btn" data-task-status="failed">
                                            <i class="fas fa-times"></i> 失败
                                        </button>
                                    </div>
                                    
                                    <div class="tasks-list" id="tasksList">
                                        <!-- 任务列表将在这里动态生成 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>

            <!-- 加载指示器 -->
            <div id="loadingOverlay" class="loading-overlay">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>正在处理文本...</p>
                </div>
            </div>

            <!-- 错误提示 -->
            <div id="errorToast" class="toast error-toast">
                <i class="fas fa-exclamation-circle"></i>
                <span id="errorMessage"></span>
                <button class="toast-close">&times;</button>
            </div>

            <!-- 成功提示 -->
            <div id="successToast" class="toast success-toast">
                <i class="fas fa-check-circle"></i>
                <span id="successMessage"></span>
                <button class="toast-close">&times;</button>
            </div>

            <!-- 警告提示 -->
            <div id="warningToast" class="toast warning-toast">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="warningMessage"></span>
                <button class="toast-close">&times;</button>
            </div>
            
            <!-- 提示词选择模态框 -->
            <div id="promptSelectModal" class="prompt-modal">
                <div class="prompt-modal-content">
                    <div class="prompt-modal-header">
                        <h3><i class="fas fa-list"></i> 选择提示词</h3>
                        <button class="prompt-modal-close" onclick="app.closePromptModal()">&times;</button>
                    </div>
                    <div class="prompt-modal-body">
                        <div class="prompt-form-group">
                            <label for="promptSelectFilter">筛选分类:</label>
                            <select id="promptSelectFilter" class="prompt-filter-select">
                                <option value="">所有分类</option>
                                <option value="translation">翻译</option>
                                <option value="polish">润色</option>
                                <option value="summary">总结</option>
                                <option value="custom">自定义</option>
                                <option value="imported">导入</option>
                            </select>
                        </div>
                        <div class="prompt-select-list" id="promptSelectList">
                            <!-- 提示词选择列表将在这里动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 添加/编辑提示词模态框 -->
            <div id="promptEditModal" class="prompt-modal">
                <div class="prompt-modal-content">
                    <div class="prompt-modal-header">
                        <h3 id="promptEditModalTitle"><i class="fas fa-plus"></i> 添加提示词</h3>
                        <button class="prompt-modal-close" onclick="app.closePromptModal()">&times;</button>
                    </div>
                    <div class="prompt-modal-body">
                        <form id="promptEditForm">
                            <div class="prompt-form-group">
                                <label for="promptNameInput">提示词名称:</label>
                                <input type="text" id="promptNameInput" placeholder="请输入提示词名称" required>
                            </div>
                            <div class="prompt-form-group">
                                <label for="promptContentInput">提示词内容:</label>
                                <textarea id="promptContentInput" placeholder="请输入提示词内容" required></textarea>
                            </div>
                            <div class="prompt-form-group">
                                <label for="promptCategoryInput">分类:</label>
                                <select id="promptCategoryInput">
                                    <option value="translation">翻译</option>
                                    <option value="polish">润色</option>
                                    <option value="summary">总结</option>
                                    <option value="custom" selected>自定义</option>
                                    <option value="imported">导入</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="prompt-modal-actions">
                        <button type="button" class="btn btn-secondary" onclick="app.closePromptModal()">取消</button>
                        <button type="button" class="btn btn-primary" id="promptSaveBtn">保存</button>
                    </div>
                </div>
            </div>
            
            <!-- 任务详情模态框 -->
            <div id="taskDetailModal" class="task-modal">
                <div class="task-modal-content">
                    <div class="task-modal-header">
                        <h3><i class="fas fa-info-circle"></i> 任务详情</h3>
                        <button class="task-modal-close" onclick="app.closeTaskDetailModal()">&times;</button>
                    </div>
                    <div class="task-modal-body">
                        <div class="task-detail-content">
                            <div class="task-detail-section">
                                <h4>任务信息</h4>
                                <div id="taskDetailInfo"></div>
                            </div>
                            <div class="task-detail-section">
                                <h4>输入内容</h4>
                                <div id="taskDetailInput"></div>
                            </div>
                            <div class="task-detail-section">
                                <h4>处理结果</h4>
                                <div id="taskDetailOutput"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    </body>
</html>
